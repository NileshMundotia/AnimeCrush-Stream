<%- include('partials/header', { cssFile: '/CSS/Common/anime.css' }) %>

<h1>Search Anime</h1>

<!-- ðŸ” Search Form -->
<form action="/search" method="POST" class="anime-search-form">
  <input type="text" name="query" placeholder="Search for anime" value="<%= query || '' %>" required>
  <button class="search_btn" type="submit">Search</button>
</form>

<% if (animeData && animeData.length > 0) { %>
  <div class="anime-results">
    <% animeData.forEach(anime => { %>
      <div class="anime-card">

        <!-- âœ… Safe Image Rendering -->
        <% if (anime.images && anime.images.jpg && anime.images.jpg.image_url) { %>
          <img src="<%= anime.images.jpg.image_url %>" alt="<%= anime.title %>">
        <% } else { %>
          <img src="/Images/default_anime.jpg" alt="No image available">
        <% } %>

        <div class="anime-card-content">
          <h5><%= anime.title %></h5>

          <!-- âœ… Safe Synopsis Display -->
          <% if (anime.synopsis) { %>
            <p><%= anime.synopsis.substring(0, 100) %>...</p>
          <% } else { %>
            <p>No synopsis available.</p>
          <% } %>

          <!-- ðŸŽ¬ Trailer Section -->
          <!-- ðŸŽ¬ Trailer Section -->
<% if (anime.trailer && (anime.trailer.embed_url || anime.trailer.url || anime.trailer.youtube_id)) { %>
  <a 
    href="<%= anime.trailer.embed_url || anime.trailer.url || `https://www.youtube.com/watch?v=${anime.trailer.youtube_id}` %>" 
    class="btn" target="_blank">
    View Trailer
  </a>
<% } else { %>
  <button class="btn" disabled style="background-color: gray;">No Trailer</button>
<% } %>


          <!-- ðŸ“º Watch or Not Available -->
          <% if (anime.isUploaded) { %>
            <a href="/watch/<%= anime.title.replace(/\s+/g, '_') %>" class="btn">Watch Now</a>
          <% } else { %>
            <button class="btn" disabled style="background-color: gray; cursor: not-allowed;">Not Available Yet</button>
          <% } %>
        </div>
      </div>
    <% }) %>
  </div>
<% } else { %>
  <p class="no-results">No results found for "<%= query || 'the search term' %>"</p>
<% } %>

<%- include('partials/footer') %>
